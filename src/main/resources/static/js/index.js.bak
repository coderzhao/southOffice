$(document).ready(function() {

    var websocket;

    if ('WebSocket' in window) {
        websocket = new WebSocket("ws://"+window.location.hostname+":8090/webSocketServer");
    } else if ('MozWebSocket' in window) {
        websocket = new MozWebSocket("ws://\""+window.location.hostname+":8090/webSocketServer");
    } else {
        websocket = new SockJS("http://localhost:27828/sockjs/webSocketServer");
    }

    websocket.onopen = function (evnt) {
        console.log("WebSocket连接成功");

    };
    websocket.onmessage = function (evnt) {
        var data = evnt.data;

        if(data.indexOf("results") != -1){
            var rootJson = JSON.parse(data);
            var photo = "data:image;base64,"+rootJson.photo;
            // $("#photo").attr("src",photo);
            var prehtml=$('#showIdentifyResults').html()
            var newContent='';
            var showHtml='';
            for(var i=0;i<rootJson.results.length;i++){
                var singleFace=rootJson.results[i];
                if(singleFace) {
                    var face = "data:image;base64," + singleFace["face"];
                    // var matchFaceURL = singleFace.matchFace;
                    // var confidence = singleFace.confidence;
                    // var meta = singleFace.meta;
                    showHtml=
                        '<div class="box">' +
                            '<div class="box_imgborder">'+
                                '<div class="box_img"><img src="' + face + '"/></div>' +
                                '<div class="box_img"><img src="' + singleFace["matchFace"] + '"/></div>' +
                                '<div class="box_img"><img src="' + photo + '"/></div>' +
                                '</div>'+
                                '<div class="box_text"><p>confidence:' + singleFace["confidence"] + '</p></div>'+
                                '<div class="box_text"><p>姓名:' + singleFace["meta"] + '</p></div>'+
                                '<div class="box_text"><p>时间:' + singleFace["timestamp"] + '</p></div>'+
                                '<div class="box_text"><p>摄像头:' + singleFace["camera"] + '</p></div>'+
                        '</div>';
                     newContent= showHtml+newContent
                }
                // var demo = $('#showIdentifyResults').html()+showHtml;
            }
            $('#showIdentifyResults').html(newContent+prehtml);

        }
    };
    websocket.onerror = function (evnt) {
        console.log("WebSocket连接出错");
    };
    websocket.onclose = function (evnt) {

        console.log("WebSocket连接关闭");
    };
});